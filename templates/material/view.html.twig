{% extends 'core/core.html.twig' %}

{% block main %}
    {# Heading #}
    <section class="grid grid-cols-1 lg:grid-cols-3">
        <div class="flex justify-center lg:justify-start items-center">
            {% if material.type == 1 %}
                {% set materialPicto = 'build/images/sheet.svg' %}
            {% elseif material.type == 2 %}
                {% set materialPicto = 'build/images/roll.svg' %}
            {% endif %}

            {% if materialPicto is defined %}
                <img src="{{ asset(materialPicto) }}" width="80" height="80"  alt="material type"/>
            {% endif %}
        </div>

        <div class="flex items-center justify-center">
            <h1 class="text-3xl">{{ material.name }}</h1>
        </div>

        <p class="w-full flex justify-center lg:justify-end mt-4 lg:mt-0 items-center">
            {% if is_granted('ROLE_MATERIAL_MANAGER') %}
                {{ include('component/button/a_button.html.twig', {
                    href: path('material_update', { id: material.id }),
                    label: 'Modifier',
                    class: 'mr-3',
                    option: { icon: 'edit', type: 'info', rounded: true }
                }) }}

                {{ include('component/button/a_button.html.twig', {
                    href: path('material_delete', { id: material.id }),
                    label: 'Supprimer',
                    option: { icon: 'trash', type: 'danger', rounded: true }
                }) }}
            {% endif %}
        </p>
    </section>

    {# Formats section #}
    <section
        class="
            rounded-xl
            bg-gray-100 drop-shadow-md
            mt-10 p-6 mx-auto
            max-w-screen-sm
        "
    >
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 mb-5">
            <div class="hidden lg:block"></div>

            <h2 class="text-2xl text-center sm:text-left lg:text-center  md:ml-4 lg:ml-0">Formats existants</h2>

            <p class="w-full flex justify-center md:justify-end mt-4 md:mt-0">
                {% if is_granted('ROLE_MATERIAL_MANAGER') %}
                    {{ include('component/button/a_button.html.twig', {
                        href: path('material_format_create', { materialId: material.id }),
                        label: 'Ajouter',
                        option: { icon: 'plus', rounded: true, size: 'small' }
                    }) }}
                {% endif %}
            </p>
        </div>

        <ul class="w-full">
            {% for format in formats %}
                <li
                    class="
                        w-full
                        px-2 sm:px-4 py-2 mt-3
                        bg-white hover:bg-gray-50
                        rounded
                        text-center
                        transition ease-in-out duration-200
                        shadow-sm
                        flex items-center justify-between
                        flex-col sm:flex-row
                    "
                >
                    <div class="mb-3 sm:mb-0">{{ format.displayName }}</div>

                    <div class="flex justify-end items-center">
                        {% if format.priority == 1 %}
                            {% set priorityColor = 'blue-200' %}
                        {% elseif format.priority == 2 %}
                            {% set priorityColor = 'gray-200' %}
                        {% elseif format.priority == 3 %}
                            {% set priorityColor = 'red-200' %}
                        {% endif %}
                        <div class="text-sm rounded-full bg-{{ priorityColor }} py-0.5 px-2">
                            {{ format.priorityLabel }}
                        </div>

                        {{ include('component/button/a_button.html.twig', {
                            href: path('material_format_update', { id: format.id }),
                            class: 'ml-2 sm:ml-5',
                            option: { icon: 'edit', type: 'info' },
                        }) }}

                        {{ include('component/button/a_button.html.twig', {
                            href: path('material_format_delete', { id: format.id }),
                            option: { icon: 'trash', type: 'danger' },
                        }) }}
                    </div>
                </li>
            {% endfor %}
        </ul>
    </section>

    {# Pieces section #}
    <section
            class="
            rounded-xl
            bg-gray-100 drop-shadow-md
            mt-10 p-6 mx-auto
            max-w-screen-sm
        "
    >
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 mb-5">
            <div class="hidden lg:block"></div>

            <h2 class="text-2xl text-center sm:text-left lg:text-center md:ml-4 lg:ml-0">Chutes dispo.</h2>

            <p class="w-full flex justify-center md:justify-end mt-4 md:mt-0">
                {{ include('component/button/a_button.html.twig', {
                    href: path('material_piece_create', { materialId: material.id }),
                    label: 'Ajouter',
                    option: { icon: 'plus', rounded: true, size: 'small' }
                }) }}
            </p>
        </div>

        <ul class="w-full">
            {% for piece in pieces %}
                <li
                        class="
                        w-full
                        px-2 sm:px-4 py-2 mt-3
                        bg-white hover:bg-gray-50
                        rounded
                        text-center
                        transition ease-in-out duration-200
                        shadow-sm
                        flex items-center justify-between
                        flex-col sm:flex-row
                    "
                >
                    <div class="flex items-center mb-3 sm:mb-0">
                        <div>{{ piece.displayName }}</div>

                        <div class="border border-gray-400 rounded-full p-0.5 ml-2">
                            {% if piece.printableFaces == 1 %}
                                {% set printableFacesImg = 'build/images/recto.svg' %}
                            {% elseif piece.printableFaces == 2 %}
                                {% set printableFacesImg = 'build/images/recto_verso.svg' %}
                            {% endif %}
                            <img src="{{ asset(printableFacesImg) }}" width="20" height="20" />
                        </div>
                    </div>

                    <div class="flex justify-end items-center">
                        <div class="text-sm rounded-full bg-blue-200 py-0.5 px-2 mr-1">
                            {{ piece.quantity }}
                            <i class="hidden sm:inline-block">dispo.</i>
                        </div>

                        <div class="text-sm rounded-full bg-orange-200 py-0.5 px-2 mr-2">
                            {{ piece.quantity }}
                            <i class="hidden sm:inline-block">réservées.</i>
                        </div>

                        {% if is_granted('ROLE_GRAPHIC_DESIGNER') %}
                            {{ include('component/button/a_button.html.twig', {
                                href: path('material_format_update', { id: piece.id }),
                                option: { icon: 'fa-regular fa-hand-pointer', type: 'info' },
                            }) }}
                        {% endif %}

                        {% if is_granted('ROLE_STORE_KEEPER') %}
                            {{ include('component/button/a_button.html.twig', {
                                href: path('material_piece_update', { id: piece.id }),
                                option: { icon: 'edit', type: 'info' },
                            }) }}

                            {{ include('component/button/a_button.html.twig', {
                                href: path('material_format_delete', { id: piece.id }),
                                option: { icon: 'trash', type: 'danger' },
                            }) }}
                        {% endif %}
                    </div>
                </li>
            {% endfor %}
        </ul>
    </section>
{% endblock %}
